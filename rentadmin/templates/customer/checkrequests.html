{% extends 'customer/customer_layout.html' %}
{% block content %}
{% load static %}
<div class="container mt-3">
    {% for m in messages %}
    <div class="alert alert-{{ m.tags }} alert-dismissible fade show" role="alert">
        <strong>{{ m }} </strong>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    {% endfor %}
    <table id="example" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>Offered By</th>
                <th>Offered Amount</th>
                <th>Offered Hours</th>
                <th>Sattled Amount</th>
                <th>Status</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for item in gigride %}
            <tr>
                <td><a href="{% url 'renterinfo' item.offered_by.renterid %}" target="_blank" class="btn btn-block btn-custom-3">{{ item.offered_by }}</a></td>
                <td>{{ item.offer_amount }}</td>
                <td>{{ item.offer_hours }}</td>
                <td>{{ item.sattled_amount }}</td>
                <td>
                    {% if item.status == 'Countered' or item.status == 'Counter Accepted' %}
                        <button type="button" class="btn btn-secondary" data-toggle="tooltip" data-placement="top" data-html="true" title="<p>Counter Hour: {{ item.counter_hours }}</p><p>Counter Amount: {{ item.counter_amount }}</p>">
                            {{ item.status }}
                        </button>
                    {% else %}
                        {{ item.status }}
                    {% endif %}
                </td>
                <td>
                    {% if item.status == 'Requested' or item.status == 'Offered' or item.status == 'Counter Accepted' %}
                    <button data-toggle="modal" data-target="#PayModal{{ item.gigrideid }}" class="btn btn-success">Accept</button>
                        {% if item.status == 'Offered' %}
                            <button data-toggle="modal" data-target="#CounterModal{{ item.gigrideid }}" class="btn btn-custom-4">Counter Offer</button>
                        {% endif %}
                    {% elif item.status == 'Completed' %}
                    <button type="button" class="btn btn-info" disabled>Completed</button>
                    {% else %}
                    <a href="#" class="btn btn-primary">Cancel</a>
                    {% endif %}
                    {% if item.status != 'Completed' %}
                        {% if item.status == 'Accepted' %}
                        <button class="btn btn-danger" disabled>Delete</button>
                        <button class="btn btn-custom-1" data-toggle="modal" data-target="#CompleteModal{{ item.gigrideid }}">Complete</button>
                        {% else %}
                        <button class="btn btn-danger" data-toggle="modal" data-target="#DeleteModal{{ item.gigrideid }}">Delete</button>
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

{% for item in gigride %}
<div class="modal fade" id="DeleteModal{{ item.gigrideid }}" tabindex="-1" role="dialog" aria-labelledby="DeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form method="post" action="{% url 'deletegigrequest' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="DeleteModalLabel"></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input name="gigrideid" type="hidden" value="{{ item.gigrideid }}">
                    <h3>Are You Sure ?</h3>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">Delete</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="PayModal{{ item.gigrideid }}" tabindex="-1" role="dialog" aria-labelledby="PayModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="PayModalLabel">Select Payment Options</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12 mt-2">
                            <button type="button" class="btn btn-lg btn-warning btn-block" data-dismiss="modal" data-toggle="modal" data-target="#PayPalModal"><img src="{% static 'images/paypal.png' %}" width="150px"></button>
                        </div>
                        <div class="col-lg-12 mt-2">
                            <button type="button" class="btn btn-lg btn-primary btn-block" data-dismiss="modal" data-toggle="modal" data-target="#CashAppModal{{ item.gigrideid }}"><img src="{% static 'images/cash.png' %}" width="150px"></button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">

                </div>
        </div>
    </div>
</div>

<div class="modal fade" id="CashAppModal{{ item.gigrideid }}" tabindex="-1" role="dialog" aria-labelledby="CashAppModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form method="post" action="{% url 'payforgig' %}">
                {% csrf_token %}
                <input type="hidden" value="{{ item.gigrideid }}" name="gigrideid">
                <div class="modal-header">
                    <h5 class="modal-title" id="CashAppModalLabel">CashApp Payment</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Transaction ID</label>
                        <input type="text" name="txnid" class="form-control btn-info" required>
                    </div>
                    <div class="form-group">
                        <label>Amount</label>
                        <input type="number" step="any" name="amount" class="form-control btn-info" required>
                    </div>
                    <div class="form-group">
                        <label>Payment Date</label>
                        <input type="date" name="paydate" class="form-control btn-info" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Submit</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="CompleteModal{{ item.gigrideid }}" tabindex="-1" role="dialog" aria-labelledby="CompleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form method="post" action="#">
                {% csrf_token %}
                <input type="hidden" value="{{ item.gigrideid }}" name="gigrideid">
                <div class="modal-header">
                    <h5 class="modal-title" id="CompleteModalLabel">Mark Gig As Comlete</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h3 style="color:green">Are You Sure ?</h3>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Complete</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="CounterModal{{ item.gigrideid }}" tabindex="-1" role="dialog" aria-labelledby="CounterModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form method="post" action="{% url 'countergigrequest' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="CounterModalLabel">Counter Offer</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input name="gigrideid" type="hidden" value="{{ item.gigrideid }}">
                    <div class="form-group">
                        <label>Counter Hour</label>
                        <input type="number" name="hours" value="{{ item.offer_hours }}" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Counter Amount</label>
                        <input type="number" step="any" name="amount" value="{{ item.offer_amount }}" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Counter Offer</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endfor %}

<script>
    $(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
</script>

{% endblock %}


